<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contentful Content Model Explorer</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>

<!-- Navigation -->
<nav class="nav">
    <div class="nav-container">
        <a href="#" class="nav-brand">Contentful <span>Explorer</span></a>
        <ul class="nav-links">
            <li><a href="#lookup">Lookup</a></li>
            <li><a href="#data-model">Data Model</a></li>
            <li><a href="#ships">Ships</a></li>
            <li><a href="#cabins">Cabins</a></li>
            <li><a href="#ports">Ports</a></li>
            <li><a href="#excursions">Excursions</a></li>
            <li><a href="#voyages">Voyages</a></li>
            <li><a href="#locales">Locales</a></li>
            <li><a href="#enrichment">Enrichment</a></li>
            <li><a href="#gaps">Gaps</a></li>
        </ul>
    </div>
</nav>

<!-- Hero -->
<section class="hero">
    <div class="container">
        <h1>Contentful <span class="gradient">Content Model</span></h1>
        <p class="subtitle">
            The Rosetta Stone between Contentful CMS and Salesforce Data Cloud booking data.
            Every code, ID, and relationship in one place.
        </p>
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number">{{ stats.ships }}</div>
                <div class="stat-label">Ships</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">{{ stats.cabins }}</div>
                <div class="stat-label">Cabin Types</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">{{ stats.ports }}</div>
                <div class="stat-label">Ports</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">{{ stats.excursions }}</div>
                <div class="stat-label">Excursions</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">{{ stats.voyage_products }}</div>
                <div class="stat-label">Voyage Products</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">{{ stats.locales }}</div>
                <div class="stat-label">Locales</div>
            </div>
        </div>
    </div>
</section>

<!-- Booking Lookup -->
<section class="section" id="lookup">
    <div class="container">
        <div class="section-label">Try It / Booking Lookup</div>
        <h2>Look Up a Booking</h2>
        <p class="section-desc">
            Enter a booking ID from Salesforce Data Cloud and see exactly what Contentful
            content would be returned for that booking - ship details, cabin info, port pages, and more.
        </p>

        <div class="lookup-form">
            <div class="lookup-fields" style="grid-template-columns: 1fr auto;">
                <div class="lookup-field">
                    <label for="lookup-booking-id">Booking ID</label>
                    <input type="text" id="lookup-booking-id" class="search-input" placeholder="Enter a booking ID or pick one below..." style="text-transform: none;">
                    <div class="lookup-hint">{{ bookings|length }} bookings loaded from Salesforce Data Cloud</div>
                </div>
                <div class="lookup-field" style="align-self: end;">
                    <button id="lookup-btn" class="lookup-button" style="margin-bottom: 22px;">Look Up</button>
                </div>
            </div>
            <div class="booking-picker">
                <span style="font-size: 13px; color: var(--text-muted); margin-right: 8px;">Quick pick:</span>
                <div class="ship-tabs" style="display: inline-flex; margin-bottom: 0;">
                    {% for booking in bookings[:8] %}
                    <button class="ship-tab booking-pick" data-id="{{ booking.booking_id }}" title="{{ booking.sailing_description }} ({{ booking.ship_code }})">
                        {{ booking.booking_id[-8:] }}
                    </button>
                    {% endfor %}
                    <button class="ship-tab" id="lookup-random" style="border-color: var(--accent-blue); color: var(--accent-blue);">Random</button>
                </div>
            </div>
        </div>

        <div id="lookup-results" class="lookup-results" style="display: none;">
            <!-- Results injected by JS -->
        </div>
    </div>
</section>

<!-- 1. Data Model Diagram -->
<section class="section" id="data-model">
    <div class="container">
        <div class="section-label">01 / Data Model</div>
        <h2>How Everything Connects</h2>
        <p class="section-desc">
            When a booking comes in from Salesforce Data Cloud, here's how each piece maps to Contentful content.
            The left column shows what's in the booking, the right shows what's in the CMS.
        </p>

        <div class="diagram-container">
            <div class="diagram-grid">
                <!-- Left: Data Cloud / Booking -->
                <div class="diagram-col">
                    <div class="entity-box">
                        <h4><span class="entity-icon" style="background: var(--accent-blue)"></span> Booking Order</h4>
                        <div class="fields">
                            <span class="key">booking_id</span> (e.g. 2113259)<br>
                            <span class="key">ship_code</span> (e.g. "TF")<br>
                            <span class="key">cabin_code</span> (e.g. "U2D")<br>
                            <span class="key">voyage_code</span> (e.g. "TF250723")<br>
                            <span class="key">market_code</span> (e.g. "UK")
                        </div>
                    </div>
                    <div class="entity-box">
                        <h4><span class="entity-icon" style="background: var(--accent-green)"></span> Sailing Line</h4>
                        <div class="fields">
                            <span class="key">port_from</span> (e.g. "BGO")<br>
                            <span class="key">port_to</span> (e.g. "TOS")<br>
                            departure_date<br>
                            arrival_date
                        </div>
                    </div>
                    <div class="entity-box">
                        <h4><span class="entity-icon" style="background: var(--accent-purple)"></span> Excursion Line</h4>
                        <div class="fields">
                            <span class="key">excursion_code</span> (e.g. "HR-TOS1")<br>
                            port<br>
                            date
                        </div>
                    </div>
                </div>

                <!-- Center: Mapping Arrows -->
                <div class="diagram-center">
                    <div class="diagram-arrow">ship_code ------></div>
                    <div class="diagram-arrow" style="margin-top: 30px">cabin_code ------></div>
                    <div class="diagram-arrow" style="margin-top: 36px">voyage_code ----></div>
                    <div class="diagram-arrow" style="margin-top: 10px">port_from ------></div>
                    <div class="diagram-arrow" style="margin-top: 24px">excursion_code -></div>
                    <div class="diagram-arrow" style="margin-top: 10px">market_code ---></div>
                </div>

                <!-- Right: Contentful -->
                <div class="diagram-col">
                    <div class="entity-box">
                        <h4><span class="entity-icon" style="background: var(--accent-cyan)"></span> shipPage</h4>
                        <div class="fields">
                            <span class="key">contentful_id</span> (e.g. "ship_TF")<br>
                            title, slug, images<br>
                            linked cabin entries
                        </div>
                    </div>
                    <div class="entity-box">
                        <h4><span class="entity-icon" style="background: var(--accent-cyan)"></span> cabin</h4>
                        <div class="fields">
                            <span class="key">cabin_code</span> (e.g. "U2D")<br>
                            name, category, size<br>
                            bed_type, window_type
                        </div>
                    </div>
                    <div class="entity-box">
                        <h4><span class="entity-icon" style="background: var(--accent-cyan)"></span> voyagePage</h4>
                        <div class="fields">
                            <span class="key">product_code</span> (e.g. "CENTFOTWI25")<br>
                            title, route, season<br>
                            category, alternate codes
                        </div>
                    </div>
                    <div class="entity-box">
                        <h4><span class="entity-icon" style="background: var(--accent-cyan)"></span> portPage</h4>
                        <div class="fields">
                            <span class="key">contentful_id</span> (no port codes)<br>
                            name, images, highlights
                        </div>
                    </div>
                    <div class="entity-box">
                        <h4><span class="entity-icon" style="background: var(--accent-cyan)"></span> excursionAndProgramme</h4>
                        <div class="fields">
                            <span class="key">bookingCode</span> (e.g. "HR-TOS1")<br>
                            title, type, price<br>
                            duration, difficulty
                        </div>
                    </div>
                    <div class="entity-box">
                        <h4><span class="entity-icon" style="background: var(--accent-cyan)"></span> Locale Config</h4>
                        <div class="fields">
                            <span class="key">market_code</span> -> locale<br>
                            e.g. "UK" -> "en-GB"<br>
                            10 market/locale pairs
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- 2. Ships -->
<section class="section" id="ships">
    <div class="container">
        <div class="section-label">02 / Ships</div>
        <h2>Fleet ({{ stats.ships }} Ships)</h2>
        <p class="section-desc">
            {{ stats.ships_with_content }} of {{ stats.ships }} ships have Contentful content.
            MS Maud has no CMS content. Ship codes (KH, TF, etc.) map to contentful_id format "ship_XX".
        </p>

        <div class="search-bar">
            <input type="text" id="search-ships" class="search-input" placeholder="Search ships...">
        </div>
        <div id="count-ships" class="result-count">{{ stats.ships }} total</div>

        <div class="data-table-wrapper">
            <table class="data-table" id="table-ships">
                <thead>
                    <tr>
                        <th>BRM Code</th>
                        <th>Ship Name</th>
                        <th>Contentful ID</th>
                        <th>Slug</th>
                        <th>Cabins</th>
                        <th>Content</th>
                    </tr>
                </thead>
                <tbody>
                    {% for ship in ships %}
                    <tr>
                        <td class="code">{{ ship.brm_code }}</td>
                        <td>{{ ship.ship_name }}</td>
                        <td class="id">{{ ship.contentful_id or '---' }}</td>
                        <td class="code">{{ ship.slug }}</td>
                        <td>{{ cabins_by_ship.get(ship.brm_code, [])|length }}</td>
                        <td>
                            {% if ship.has_contentful_content == 'True' %}
                                <span class="badge badge-green">Yes</span>
                            {% else %}
                                <span class="badge badge-red">No</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</section>

<!-- 3. Cabins -->
<section class="section" id="cabins">
    <div class="container">
        <div class="section-label">03 / Cabins</div>
        <h2>Cabin Types ({{ stats.cabins }} Total)</h2>
        <p class="section-desc">
            Cabins are ship-specific - a "U2D" on MS Trollfjord is different from "U2D" on MS Nordkapp.
            {{ stats.cabin_categories }} categories: Expedition Suite, Arctic Superior, Polar Outside, Polar Inside.
        </p>

        <div class="ship-tabs">
            <button class="ship-tab active" data-ship="all">All Ships</button>
            {% for ship in ships %}
            <button class="ship-tab" data-ship="{{ ship.brm_code }}">{{ ship.brm_code }}</button>
            {% endfor %}
        </div>

        {% for ship_code, ship_cabins in cabins_by_ship.items() %}
        <div class="cabin-ship-group" data-ship="{{ ship_code }}" style="margin-bottom: 24px;">
            <h3 style="font-size: 16px; color: var(--text-secondary); margin-bottom: 12px;">
                {{ stats.ships_by_code.get(ship_code, ship_code) }}
                <span style="color: var(--text-muted); font-size: 13px;">({{ ship_cabins|length }} cabin types)</span>
            </h3>
            <div class="data-table-wrapper">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Code</th>
                            <th>Name</th>
                            <th>Category</th>
                            <th>Bed Type</th>
                            <th>Window</th>
                            <th>Size (m2)</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for cabin in ship_cabins %}
                        <tr>
                            <td class="code">{{ cabin.cabin_code }}</td>
                            <td>{{ cabin.cabin_name }}</td>
                            <td>
                                {% if cabin.cabin_category == 'Expedition Suite' %}
                                    <span class="badge badge-purple">{{ cabin.cabin_category }}</span>
                                {% elif cabin.cabin_category == 'Arctic Superior' %}
                                    <span class="badge badge-blue">{{ cabin.cabin_category }}</span>
                                {% elif cabin.cabin_category == 'Polar Outside' %}
                                    <span class="badge badge-green">{{ cabin.cabin_category }}</span>
                                {% else %}
                                    <span class="badge badge-yellow">{{ cabin.cabin_category }}</span>
                                {% endif %}
                            </td>
                            <td>{{ cabin.bed_type }}</td>
                            <td>{{ cabin.window_type }}</td>
                            <td>{{ cabin.size_from }}{% if cabin.size_to and cabin.size_to != cabin.size_from %}-{{ cabin.size_to }}{% endif %}</td>
                            <td>
                                <button class="expand-btn" data-target="cabin-{{ ship_code }}-{{ loop.index }}">Details</button>
                            </td>
                        </tr>
                        <tr class="expand-row" id="cabin-{{ ship_code }}-{{ loop.index }}">
                            <td colspan="7">
                                <div class="expand-detail">
                                    <div class="detail-item">
                                        <div class="detail-label">Ship</div>
                                        <div class="detail-value">{{ cabin.ship_name }}</div>
                                    </div>
                                    <div class="detail-item">
                                        <div class="detail-label">Balcony</div>
                                        <div class="detail-value">{{ 'Yes' if cabin.has_balcony == 'True' else 'No' }}</div>
                                    </div>
                                    <div class="detail-item" style="grid-column: 1 / -1;">
                                        <div class="detail-label">Description</div>
                                        <div class="detail-value">{{ cabin.cabin_description }}</div>
                                    </div>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        {% endfor %}
    </div>
</section>

<!-- 4. Ports -->
<section class="section" id="ports">
    <div class="container">
        <div class="section-label">04 / Ports</div>
        <h2>Ports of Call ({{ stats.ports }})</h2>
        <p class="section-desc">
            Contentful stores ports as "portPage" entries with a name and contentful_id.
            There are no 3-letter port codes (like BGO, TOS) in the CMS - matching to booking data
            requires a name-based lookup or a separate mapping table.
        </p>

        <div class="search-bar">
            <input type="text" id="search-ports" class="search-input" placeholder="Search ports...">
        </div>
        <div id="count-ports" class="result-count">{{ stats.ports }} total</div>

        <div class="data-table-wrapper">
            <table class="data-table" id="table-ports">
                <thead>
                    <tr>
                        <th>Port Name</th>
                        <th>Contentful ID</th>
                    </tr>
                </thead>
                <tbody>
                    {% for port in ports %}
                    <tr>
                        <td>{{ port.port_name }}</td>
                        <td class="id" style="max-width: none;">{{ port.contentful_id }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</section>

<!-- 5. Excursions -->
<section class="section" id="excursions">
    <div class="container">
        <div class="section-label">05 / Excursions</div>
        <h2>Excursions & Programmes ({{ stats.excursions }})</h2>
        <p class="section-desc">
            Excursions use a "bookingCode" field (e.g. HR-TOS1) that directly matches
            the excursion codes in booking data. This is the cleanest join in the model.
            Types: {{ stats.excursion_types | join(', ') }}.
        </p>

        <!-- Seasonal Variants Callout -->
        <div class="callout callout-warning" style="margin-bottom: 24px;">
            <h4 style="margin: 0 0 8px 0; color: var(--accent-yellow);">Seasonal Variants: 4 codes have summer/winter versions</h4>
            <p style="margin: 0 0 12px 0; color: var(--text-secondary); font-size: 14px;">
                These booking codes each have <strong>two Contentful entries</strong> with different content,
                durations, and sometimes prices depending on season. The seasons overlap in Spring and Autumn,
                so you need the sailing date to pick the right version.
            </p>
            <table class="data-table" style="margin: 0;">
                <thead>
                    <tr>
                        <th>Code</th>
                        <th>Summer Version</th>
                        <th>Winter Version</th>
                        <th>Overlap</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td class="code">HRS-HVG2</td>
                        <td>North Cape & King Crab (5 hrs)</td>
                        <td>North Cape & King Crab (6-7 hrs)</td>
                        <td><span class="badge badge-yellow">Spring, Autumn, Winter</span></td>
                    </tr>
                    <tr>
                        <td class="code">HRS-SVJ2</td>
                        <td>Fishing in Lofoten (3h15, 1990 NOK)</td>
                        <td>Fishing in Lofoten (2h45, 1790 NOK)</td>
                        <td><span class="badge badge-yellow">Spring, Autumn</span></td>
                    </tr>
                    <tr>
                        <td class="code">HRS-SVJ3</td>
                        <td>Kayaking in Lofoten (3 hrs)</td>
                        <td>Kayaking in Lofoten (2h30)</td>
                        <td><span class="badge badge-yellow">Spring, Autumn</span></td>
                    </tr>
                    <tr>
                        <td class="code">HRS-TOS3</td>
                        <td>Troms&oslash; E-bike (1790 NOK)</td>
                        <td>Troms&oslash; E-bike Autumn (1590 NOK)</td>
                        <td><span class="badge badge-yellow">Spring, Summer, Autumn</span></td>
                    </tr>
                </tbody>
            </table>
            <p style="margin: 8px 0 0 0; color: var(--text-tertiary); font-size: 13px;">
                Rule of thumb: Jun-Aug = summer slug, Nov-Mar = winter slug, Apr-May &amp; Sep-Oct = default to summer.
            </p>
        </div>

        <div class="search-bar">
            <input type="text" id="search-excursions" class="search-input" placeholder="Search excursions...">
            <select id="filter-excursions" class="filter-select">
                <option value="">All Types</option>
                {% for t in stats.excursion_types %}
                <option value="{{ t }}">{{ t }}</option>
                {% endfor %}
            </select>
        </div>
        <div id="count-excursions" class="result-count">{{ stats.excursions }} total</div>

        <div class="data-table-wrapper" style="max-height: 600px; overflow-y: auto;">
            <table class="data-table" id="table-excursions">
                <thead>
                    <tr>
                        <th>Booking Code</th>
                        <th>Title</th>
                        <th>Type</th>
                        <th>Seasons</th>
                        <th>Duration</th>
                        <th>Difficulty</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    {% for exc in excursions %}
                    <tr data-filter="{{ exc.type }}">
                        <td class="code">{{ exc.booking_code }}</td>
                        <td>{{ exc.title }}</td>
                        <td>
                            {% if exc.type == 'Excursion' %}
                                <span class="badge badge-blue">{{ exc.type }}</span>
                            {% elif exc.type == 'Pre-programme' %}
                                <span class="badge badge-green">{{ exc.type }}</span>
                            {% elif exc.type == 'Pre-Post-programme' %}
                                <span class="badge badge-purple">{{ exc.type }}</span>
                            {% else %}
                                <span class="badge badge-yellow">{{ exc.type }}</span>
                            {% endif %}
                        </td>
                        <td style="font-size: 12px; color: var(--text-secondary);">
                            {% if exc.seasons %}
                                {% for s in exc.seasons.split(' | ') %}
                                    <span class="badge badge-{% if 'Summer' in s %}blue{% elif 'Winter' in s %}purple{% elif 'Spring' in s %}green{% else %}yellow{% endif %}" style="font-size: 10px; padding: 1px 6px; margin: 1px 0;">{{ s.split(' (')[0] }}</span>
                                {% endfor %}
                            {% else %}
                                <span style="color: var(--text-tertiary);">---</span>
                            {% endif %}
                        </td>
                        <td>{{ exc.duration }}</td>
                        <td style="font-size: 12px; color: var(--text-secondary);">{{ exc.difficulty_level[:30] if exc.difficulty_level else '---' }}</td>
                        <td>
                            <button class="expand-btn" data-target="exc-{{ loop.index }}">Details</button>
                        </td>
                    </tr>
                    <tr class="expand-row" id="exc-{{ loop.index }}">
                        <td colspan="7">
                            <div class="expand-detail">
                                <div class="detail-item">
                                    <div class="detail-label">Price</div>
                                    <div class="detail-value">{{ exc.price }} {{ exc.currency }}</div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-label">Seasons</div>
                                    <div class="detail-value">{{ exc.seasons.replace(' | ', ', ') if exc.seasons else 'All year' }}</div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-label">Valid Years</div>
                                    <div class="detail-value">{{ exc.years.replace(' | ', ', ') if exc.years else '---' }}</div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-label">Slug</div>
                                    <div class="detail-value code">{{ exc.slug or '---' }}</div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-label">Categories</div>
                                    <div class="detail-value">{{ exc.categories or '---' }}</div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-label">Full Difficulty</div>
                                    <div class="detail-value">{{ exc.difficulty_level or '---' }}</div>
                                </div>
                                {% if exc.slug %}
                                <div class="detail-item" style="grid-column: 1 / -1;">
                                    <a href="https://www.hurtigruten.com/en/extras/excursions/{{ exc.slug }}" target="_blank" class="result-link" style="display: inline-block;">View on hurtigruten.com</a>
                                </div>
                                {% endif %}
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</section>

<!-- 6. Voyage Products -->
<section class="section" id="voyages">
    <div class="container">
        <div class="section-label">06 / Voyage Products</div>
        <h2>Voyage Products ({{ stats.voyage_products }})</h2>
        <p class="section-desc">
            Voyages in Contentful use "product codes" (like CENTFOTWI25) that are different from
            the sailing codes in booking data (like TF250723). Matching requires a lookup.
            Some short voyages have no product code at all.
        </p>

        <div class="search-bar">
            <input type="text" id="search-voyage-products" class="search-input" placeholder="Search voyages...">
            <select id="filter-voyage-products" class="filter-select">
                <option value="">All Categories</option>
                {% for cat in stats.voyage_categories %}
                <option value="{{ cat }}">{{ cat }}</option>
                {% endfor %}
            </select>
        </div>
        <div id="count-voyage-products" class="result-count">{{ stats.voyage_products }} total</div>

        <div class="data-table-wrapper" style="max-height: 600px; overflow-y: auto;">
            <table class="data-table" id="table-voyage-products">
                <thead>
                    <tr>
                        <th>Product Code</th>
                        <th>Title</th>
                        <th>Type</th>
                        <th>Route</th>
                        <th>Season</th>
                        <th>Category</th>
                        <th>Contentful ID</th>
                    </tr>
                </thead>
                <tbody>
                    {% for vp in voyage_products %}
                    <tr data-filter="{{ vp.category }}">
                        <td class="code">{{ vp.product_code or '---' }}</td>
                        <td>{{ vp.title }}</td>
                        <td>
                            {% if vp.voyage_type == 'Classic' %}
                                <span class="badge badge-blue">{{ vp.voyage_type }}</span>
                            {% else %}
                                <span class="badge badge-cyan">{{ vp.voyage_type }}</span>
                            {% endif %}
                        </td>
                        <td style="font-size: 13px; color: var(--text-secondary);">{{ vp.route_description }}</td>
                        <td style="font-size: 12px;">{{ vp.season }}</td>
                        <td style="font-size: 12px; color: var(--text-secondary);">{{ vp.category }}</td>
                        <td class="id">{{ vp.contentful_id }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</section>

<!-- 7. Locales -->
<section class="section" id="locales">
    <div class="container">
        <div class="section-label">07 / Locales</div>
        <h2>Market Locales ({{ stats.locales }})</h2>
        <p class="section-desc">
            Each market code from booking data maps to a Contentful locale.
            Content is localised per market - requesting "en-GB" returns UK content,
            "de-DE" returns German content. Booking codes are stored in the default locale (en) only.
        </p>

        <div class="locale-grid">
            {% set flags = {'AT': 'ðŸ‡¦ðŸ‡¹', 'AU': 'ðŸ‡¦ðŸ‡º', 'CH': 'ðŸ‡¨ðŸ‡­', 'DE': 'ðŸ‡©ðŸ‡ª', 'DK': 'ðŸ‡©ðŸ‡°', 'FR': 'ðŸ‡«ðŸ‡·', 'NO': 'ðŸ‡³ðŸ‡´', 'SE': 'ðŸ‡¸ðŸ‡ª', 'UK': 'ðŸ‡¬ðŸ‡§', 'US': 'ðŸ‡ºðŸ‡¸'} %}
            {% set names = {'AT': 'Austria', 'AU': 'Australia', 'CH': 'Switzerland', 'DE': 'Germany', 'DK': 'Denmark', 'FR': 'France', 'NO': 'Norway', 'SE': 'Sweden', 'UK': 'United Kingdom', 'US': 'United States'} %}
            {% for locale in locales %}
            <div class="locale-card">
                <div class="locale-flag">{{ flags.get(locale.market_code, '') }}</div>
                <div class="locale-info">
                    <div class="locale-code">{{ locale.market_code }} -> {{ locale.contentful_locale }}</div>
                    <div class="locale-name">{{ names.get(locale.market_code, locale.market_code) }}</div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</section>

<!-- 8. Email Enrichment: Before/After -->
<section class="section" id="enrichment">
    <div class="container">
        <div class="section-label">08 / Email Enrichment</div>
        <h2>Before &amp; After: Real Booking Emails</h2>
        <p class="section-desc">
            Real booking patterns from Salesforce Data Cloud (anonymized). What guests get today vs what
            they could get when CMS content is included. This is the business case for the CF-SFMC data design.
        </p>

        <!-- Example selector tabs -->
        <div class="enrichment-tabs">
            <button class="enrichment-tab active" data-example="1">
                <span class="tab-flag">UK</span>
                <span class="tab-label">MS Kong Harald<br><small>11 nights Â· Full Board</small></span>
            </button>
            <button class="enrichment-tab" data-example="2">
                <span class="tab-flag">US</span>
                <span class="tab-label">MS Richard With<br><small>6 nights Â· Full Board</small></span>
            </button>
            <button class="enrichment-tab" data-example="3">
                <span class="tab-flag">DE</span>
                <span class="tab-label">MS Finnmarken<br><small>14 nights Â· All-Inclusive</small></span>
            </button>
        </div>

        <!-- Example 1: UK Kong Harald -->
        <div class="enrichment-example active" id="example-1">
            <div class="enrichment-booking-header">
                <div class="booking-detail"><strong>Ship:</strong> MS Kong Harald (KH)</div>
                <div class="booking-detail"><strong>Route:</strong> Bergen â†’ Kirkenes â†’ Bergen</div>
                <div class="booking-detail"><strong>Duration:</strong> 11 nights</div>
                <div class="booking-detail"><strong>Cabin:</strong> U2D (Upper Deck Double), P2D (Polar Outside)</div>
                <div class="booking-detail"><strong>Meal:</strong> Full Board</div>
                <div class="booking-detail"><strong>Market:</strong> UK</div>
            </div>
            <div class="before-after-grid">
                <div class="before-card">
                    <div class="ba-label ba-before">Before <span>Salesforce Only</span></div>
                    <div class="ba-content">
                        <div class="ba-line"><span class="ba-field">Ship:</span> KH</div>
                        <div class="ba-line"><span class="ba-field">Route:</span> BGO â†’ BGO</div>
                        <div class="ba-line"><span class="ba-field">Cabin:</span> U2D, P2D</div>
                        <div class="ba-line"><span class="ba-field">Meal:</span> Full Board</div>
                        <div class="ba-line"><span class="ba-field">Extras:</span> Tea & Coffee Package, Unlimited Wi-Fi</div>
                        <div class="ba-empty">
                            <div class="ba-empty-icon">Ã—</div>
                            No ship images<br>
                            No cabin photos or descriptions<br>
                            No port content<br>
                            No meal details<br>
                            No deck plans<br>
                            No amenity information
                        </div>
                    </div>
                </div>
                <div class="after-card">
                    <div class="ba-label ba-after">After <span>+ Contentful CMS</span></div>
                    <div class="ba-content">
                        <div class="ba-enriched-block">
                            <div class="ba-enriched-source">shipPage Â· code=KH</div>
                            <div class="ba-enriched-title">Your Voyage on MS Kong Harald</div>
                            <div class="ba-enriched-detail">Hero image + ship description + "combining classic maritime heritage with modern comfort"</div>
                        </div>
                        <div class="ba-enriched-block">
                            <div class="ba-enriched-source">cabin Â· code=U2D + ship KH</div>
                            <div class="ba-enriched-title">Upper Deck Double with Window</div>
                            <div class="ba-enriched-detail">Cabin photo Â· Deck 6 Â· 8-12 mÂ² Â· Ocean view Â· Double bed Â· TV, bathroom</div>
                        </div>
                        <div class="ba-enriched-block">
                            <div class="ba-enriched-source">cabin Â· code=P2D + ship KH</div>
                            <div class="ba-enriched-title">Polar Outside Double</div>
                            <div class="ba-enriched-detail">Cabin photo Â· Deck 5 Â· 10-13 mÂ² Â· Ocean view Â· Double bed</div>
                        </div>
                        <div class="ba-enriched-block">
                            <div class="ba-enriched-source">portPage Â· code=BGO</div>
                            <div class="ba-enriched-title">Departing from Bergen</div>
                            <div class="ba-enriched-detail">Hero image Â· "Framed by fjords, alive with colour â€“ Bergen's Bryggen wharf is a UNESCO World Heritage Site"</div>
                        </div>
                        <div class="ba-enriched-block">
                            <div class="ba-enriched-source">mealPlan Â· code=FB</div>
                            <div class="ba-enriched-title">Your Dining: Full Board</div>
                            <div class="ba-enriched-detail">Restaurant photo Â· Breakfast: Scandinavian buffet 07:00-10:00 Â· Lunch: seasonal coastal 12:00-14:00 Â· Dinner: three-course or buffet 18:00-20:00</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Example 2: US Richard With -->
        <div class="enrichment-example" id="example-2">
            <div class="enrichment-booking-header">
                <div class="booking-detail"><strong>Ship:</strong> MS Richard With (RW)</div>
                <div class="booking-detail"><strong>Route:</strong> TromsÃ¸ â†’ Bergen (southbound)</div>
                <div class="booking-detail"><strong>Duration:</strong> 6 nights</div>
                <div class="booking-detail"><strong>Cabin:</strong> Q4 (Arctic Superior), CUO (Unspecified Outside)</div>
                <div class="booking-detail"><strong>Meal:</strong> Full Board</div>
                <div class="booking-detail"><strong>Market:</strong> US</div>
            </div>
            <div class="before-after-grid">
                <div class="before-card">
                    <div class="ba-label ba-before">Before <span>Salesforce Only</span></div>
                    <div class="ba-content">
                        <div class="ba-line"><span class="ba-field">Ship:</span> RW</div>
                        <div class="ba-line"><span class="ba-field">Route:</span> TOS â†’ BGO</div>
                        <div class="ba-line"><span class="ba-field">Cabin:</span> Q4, CUO</div>
                        <div class="ba-line"><span class="ba-field">Meal:</span> Full Board</div>
                        <div class="ba-line"><span class="ba-field">Extras:</span> Tea & Coffee Package, Unlimited Wi-Fi</div>
                        <div class="ba-empty">
                            <div class="ba-empty-icon">Ã—</div>
                            No ship images<br>
                            No cabin photos or size info<br>
                            No port descriptions<br>
                            No meal details beyond "Full Board"<br>
                            No amenity list
                        </div>
                    </div>
                </div>
                <div class="after-card">
                    <div class="ba-label ba-after">After <span>+ Contentful CMS</span></div>
                    <div class="ba-content">
                        <div class="ba-enriched-block">
                            <div class="ba-enriched-source">shipPage Â· code=RW</div>
                            <div class="ba-enriched-title">Your Voyage on MS Richard With</div>
                            <div class="ba-enriched-detail">Hero image + "One of the newest ships on the coastal route, with panoramic lounges and Nordic-inspired dining"</div>
                        </div>
                        <div class="ba-enriched-block">
                            <div class="ba-enriched-source">cabin Â· code=Q4 + ship RW</div>
                            <div class="ba-enriched-title">Arctic Superior</div>
                            <div class="ba-enriched-detail">Cabin photo Â· Deck 6 Â· 14-17 mÂ² Â· Panoramic window Â· Double bed, TV, minibar, sofa, dinner table</div>
                        </div>
                        <div class="ba-enriched-block">
                            <div class="ba-enriched-source">portPage Â· code=TOS</div>
                            <div class="ba-enriched-title">Departing from TromsÃ¸</div>
                            <div class="ba-enriched-detail">Hero image Â· "The Arctic capital, where colourful houses line the harbour and the midnight sun illuminates snow-capped peaks"</div>
                        </div>
                        <div class="ba-enriched-block">
                            <div class="ba-enriched-source">portPage Â· code=BGO</div>
                            <div class="ba-enriched-title">Arriving in Bergen</div>
                            <div class="ba-enriched-detail">Hero image Â· UNESCO World Heritage Bryggen wharf description</div>
                        </div>
                        <div class="ba-enriched-block">
                            <div class="ba-enriched-source">mealPlan Â· code=FB Â· locale=en-US</div>
                            <div class="ba-enriched-title">Your Dining: Full Board</div>
                            <div class="ba-enriched-detail">Restaurant photo Â· "Full board (breakfast, lunch, & dinner)" â€” US-specific expanded title with meal descriptions</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Example 3: German Finnmarken All-Inclusive -->
        <div class="enrichment-example" id="example-3">
            <div class="enrichment-booking-header">
                <div class="booking-detail"><strong>Ship:</strong> MS Finnmarken (SV)</div>
                <div class="booking-detail"><strong>Route:</strong> Hamburg â†’ Hamburg (round-trip)</div>
                <div class="booking-detail"><strong>Duration:</strong> 14 nights</div>
                <div class="booking-detail"><strong>Cabin:</strong> N2 (Suite)</div>
                <div class="booking-detail"><strong>Meal:</strong> Full Board + All-Inclusive + AIPACK</div>
                <div class="booking-detail"><strong>Market:</strong> DE</div>
            </div>
            <div class="before-after-grid">
                <div class="before-card">
                    <div class="ba-label ba-before">Before <span>Salesforce Only</span></div>
                    <div class="ba-content">
                        <div class="ba-line"><span class="ba-field">Schiff:</span> SV</div>
                        <div class="ba-line"><span class="ba-field">Route:</span> HAM â†’ HAM</div>
                        <div class="ba-line"><span class="ba-field">Kabine:</span> N2</div>
                        <div class="ba-line"><span class="ba-field">Verpflegung:</span> Full Board</div>
                        <div class="ba-line ba-problem"><span class="ba-field">Paket:</span> Meal & Beverage Package Norwegian <em>Costal</em> Kitchen</div>
                        <div class="ba-line"><span class="ba-field">Paket:</span> Meal Beverage Package Expedition</div>
                        <div class="ba-line"><span class="ba-field">Extras:</span> Onboard Credit 250 EUR, Included Activity Package</div>
                        <div class="ba-empty">
                            <div class="ba-empty-icon">Ã—</div>
                            "Costal" misspelled in SF data<br>
                            English-only labels for German guest<br>
                            No restaurant names or drink details<br>
                            No suite perks explained<br>
                            No deck plan, no cabin photos
                        </div>
                    </div>
                </div>
                <div class="after-card">
                    <div class="ba-label ba-after">After <span>+ Contentful CMS Â· de-DE</span></div>
                    <div class="ba-content">
                        <div class="ba-enriched-block">
                            <div class="ba-enriched-source">shipPage Â· code=SV Â· de-DE</div>
                            <div class="ba-enriched-title">Ihre Reise auf der MS Finnmarken</div>
                            <div class="ba-enriched-detail">Hero image + German ship description Â· Ab Hamburg Â· 14 NÃ¤chte Â· Rundreise Norwegen</div>
                        </div>
                        <div class="ba-enriched-block">
                            <div class="ba-enriched-source">cabin Â· code=N2 + ship SV</div>
                            <div class="ba-enriched-title">Suite</div>
                            <div class="ba-enriched-detail">Suite photo Â· Deck 7 Â· 22-30 mÂ² Â· Balkon Â· Doppelbett, Sofa, Esstisch, TV, Bad</div>
                        </div>
                        <div class="ba-enriched-block">
                            <div class="ba-enriched-source">deckPlan Â· ship SV Â· deck 7</div>
                            <div class="ba-enriched-title">Deckplan</div>
                            <div class="ba-enriched-detail">SVG deck layout showing suite location on Deck 7</div>
                        </div>
                        <div class="ba-enriched-block">
                            <div class="ba-enriched-source">mealPlan Â· code=FB Â· de-DE</div>
                            <div class="ba-enriched-title">Vollpension</div>
                            <div class="ba-enriched-detail">Restaurant photo Â· FrÃ¼hstÃ¼ck, Mittag- und Abendessen tÃ¤glich im Hauptrestaurant</div>
                        </div>
                        <div class="ba-enriched-block">
                            <div class="ba-enriched-source">mealPlan Â· code=AIPNCK Â· de-DE</div>
                            <div class="ba-enriched-title">All-inclusive Norwegische KÃ¼stenkÃ¼che</div>
                            <div class="ba-enriched-detail">Photo Â· Speisen im Flora und Arran Restaurant Â· Unbegrenzte ausgewÃ¤hlte GetrÃ¤nke Â· Suite-GÃ¤ste speisen im Rost</div>
                        </div>
                        <div class="ba-enriched-block">
                            <div class="ba-enriched-source">mealPlan Â· code=AIPACK Â· de-DE</div>
                            <div class="ba-enriched-title">All-inclusive</div>
                            <div class="ba-enriched-detail">Premium food + unlimited selected drinks Â· German locale with proper descriptions</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Summary table -->
        <div class="enrichment-summary">
            <h3>What Changes</h3>
            <table class="enrichment-table">
                <thead>
                    <tr>
                        <th>Email Element</th>
                        <th>Before (SF Only)</th>
                        <th>After (+ Contentful)</th>
                        <th>CF Source</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Ship</td>
                        <td class="cell-before">Code only ("KH")</td>
                        <td class="cell-after">Name + hero photo + description</td>
                        <td><code>shipPage.code</code></td>
                    </tr>
                    <tr>
                        <td>Cabin</td>
                        <td class="cell-before">Code only ("U2D")</td>
                        <td class="cell-after">Name + photo + size + amenity icons</td>
                        <td><code>cabin.code</code></td>
                    </tr>
                    <tr>
                        <td>Port</td>
                        <td class="cell-before">Code only ("BGO")</td>
                        <td class="cell-after">Name + hero image + marketing copy</td>
                        <td><code>portPage.code</code></td>
                    </tr>
                    <tr>
                        <td>Meal plan</td>
                        <td class="cell-before">Short label, sometimes misspelled</td>
                        <td class="cell-after">Rich descriptions, serving times, menus, photos</td>
                        <td><code>mealPlan.code</code></td>
                    </tr>
                    <tr>
                        <td>All-inclusive</td>
                        <td class="cell-before">Vague English text</td>
                        <td class="cell-after">Restaurant names, drink policy, suite perks</td>
                        <td><code>mealPlan.code</code></td>
                    </tr>
                    <tr>
                        <td>Deck plan</td>
                        <td class="cell-before">Nothing</td>
                        <td class="cell-after">SVG deck layout showing cabin location</td>
                        <td><code>deckPlan</code></td>
                    </tr>
                    <tr>
                        <td>Amenities</td>
                        <td class="cell-before">Nothing</td>
                        <td class="cell-after">Bed type, window, facilities with icons</td>
                        <td><code>facility</code></td>
                    </tr>
                    <tr>
                        <td>Language</td>
                        <td class="cell-before">English labels only</td>
                        <td class="cell-after">10 locales (DE, FR, NO, DK, SE, AU, US, AT, CH)</td>
                        <td>All types</td>
                    </tr>
                    <tr>
                        <td>Images</td>
                        <td class="cell-before">Zero</td>
                        <td class="cell-after">Hero images for ship, cabin, ports, dining</td>
                        <td>All types</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</section>

<!-- 9. Known Gaps -->
<section class="section" id="gaps">
    <div class="container">
        <div class="section-label">09 / Known Gaps</div>
        <h2>Integration Gotchas</h2>
        <p class="section-desc">
            These are the things that will trip you up when connecting Data Cloud bookings to Contentful content.
        </p>

        <div class="gaps-grid">
            <div class="gap-card" style="border-left-color: var(--accent-red);">
                <h4>
                    <span class="severity" style="color: var(--accent-red);">High</span>
                    Voyage Code Mismatch
                </h4>
                <p>
                    Booking sailing codes (e.g. "TF250723") are completely different from Contentful
                    product codes (e.g. "CENTFOTWI25"). There is no direct lookup - you need a
                    separate mapping table or fuzzy matching on route + ship + season.
                </p>
            </div>
            <div class="gap-card" style="border-left-color: var(--accent-yellow);">
                <h4>
                    <span class="severity" style="color: var(--accent-yellow);">Resolved</span>
                    Port Codes Now Mapped
                </h4>
                <p>
                    Booking data uses 3-letter port codes (BGO, TOS, KKN). Contentful stores port names
                    and slugs but not these codes directly. We built a mapping table (port code -> contentful_id)
                    with 99.3% match rate. Only a handful of minor ports remain unmapped.
                </p>
            </div>
            <div class="gap-card" style="border-left-color: var(--accent-yellow);">
                <h4>
                    <span class="severity" style="color: var(--accent-yellow);">Medium</span>
                    Booking Codes in Default Locale Only
                </h4>
                <p>
                    The "bookingCode" field on excursions is only stored in the default locale (en).
                    When querying with a non-English locale, you must also request the default locale
                    to get the matching code.
                </p>
            </div>
            <div class="gap-card" style="border-left-color: var(--accent-yellow);">
                <h4>
                    <span class="severity" style="color: var(--accent-yellow);">Resolved</span>
                    MS Maud = MS Midnatsol (Alias WW)
                </h4>
                <p>
                    Ship code "MS" (MS Maud) is the same ship as MS Midnatsol, renamed.
                    Contentful stores all cabin and deck content under ship code "WW".
                    Lookups now use alias mapping: MS -> WW. Deck plans in CF confirm this
                    with titles like "MS Maud(WW)".
                </p>
            </div>
            <div class="gap-card" style="border-left-color: var(--accent-red);">
                <h4>
                    <span class="severity" style="color: var(--accent-red);">High</span>
                    Seasonal Excursion Variants
                </h4>
                <p>
                    4 booking codes (HRS-HVG2, HRS-SVJ2, HRS-SVJ3, HRS-TOS3) have both summer
                    and winter versions in Contentful with different durations, prices, and slugs.
                    In Spring (Apr-May) and Autumn (Sep-Oct) BOTH variants are valid - the booking
                    code alone cannot disambiguate which content to show.
                </p>
            </div>
            <div class="gap-card">
                <h4>
                    <span class="severity" style="color: var(--accent-blue);">Info</span>
                    Ship-Specific Cabin Codes
                </h4>
                <p>
                    Cabin code "U2D" means different things on different ships. A cabin lookup
                    must always include both the ship code AND cabin code. Never look up a
                    cabin by code alone.
                </p>
            </div>
            <div class="gap-card">
                <h4>
                    <span class="severity" style="color: var(--accent-blue);">Info</span>
                    Short Voyages Lack Product Codes
                </h4>
                <p>
                    21 of {{ stats.voyage_products }} voyage products are short voyages without any
                    product code. These can only be matched by title and route description,
                    not by a clean code lookup.
                </p>
            </div>
        </div>
    </div>
</section>

<!-- Footer -->
<footer class="footer">
    <div class="container">
        <p>
            Contentful Content Model Explorer &middot;
            Data sourced from Contentful CMS exports &middot;
            Built for the Data Cloud integration team
        </p>
    </div>
</footer>

<script>
    window.LOOKUP_DATA = {
        ships: {{ ships_json|safe }},
        cabins: {{ cabins_json|safe }},
        excursions: {{ excursions_json|safe }},
        ports: {{ ports_json|safe }},
        voyage_products: {{ voyage_products_json|safe }},
        locales: {{ locales_json|safe }},
        bookings: {{ bookings_json|safe }}
    };
</script>
<script src="{{ url_for('static', filename='app.js') }}"></script>
</body>
</html>
